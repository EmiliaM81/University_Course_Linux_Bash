#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define SIZE_RECORD  1024
#define SIZE_TEXT (RECORD_SIZE - sizeof(int)) // Rozmiar tekstu po odjęciu pola id

/**
Struktura Record
przechowuje dane rekordu
**/

typedef struct {
    int id;
    char text[SIZE_TEXT];
} Record;

void record_read(const char *filename, int record_number) {
    FILE *plik = fopen(filename, "rb");
    if (!plik) {
        perror("Error opening file");
        exit(1);
    }

    /* Przesunięcie wskaźnika pliku na początek żądanego rekordu */
    if (fseek(plik, number_record * sizeof(Record), SEEK_SET) != 0) {
        perror("Error seeking in file");
        fclose(plik);
        exit(1);
    }

    Record record;
    t_size read_size = fread(&record, sizeof(Record), 1, plik);
    if (size_read != 1) {
        if (feof(plik)) {
            fprintf(stderr, "Error: Record number %d does not exist in the file.\n", number_record);
        } else {
            perror("Error reading from file");
        }
        fclose(plik);
        exit(1);
    }

    /** Wyświetlenie zawartości rekordu
    */
    printf("Record ID: %d\n", record.id);
    printf("Text: %s\n", record.text);

    fclose(plik);
}
/**
Program główny
*/
int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: %s <name_file> <record_number>\n", argv[0]);
        return 1;
     }

    const char *filename = argv[1];
    int number_record = atoi(argv[2]);
    if (number_record < 0) {
      fprintf(stderr, "Error: Record number must be a non-negative integer.\n");
      return 1;
    }

    record_read(filename, record_number); // czytamy rekord
    return 0;
}
